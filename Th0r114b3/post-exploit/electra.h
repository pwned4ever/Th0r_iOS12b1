//
//  electra.h
//  electra1131
//
//  Created by CoolStar on 6/6/18.
//  Copyright Â© 2018 CoolStar. All rights reserved.
//

#ifndef electra_h
#define electra_h

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#import <sys/mount.h>
#import <spawn.h>
#import <mach-o/dyld.h>
#import <sys/types.h>
#import <sys/stat.h>
#import <sys/utsname.h>

#include <mach/mach.h>

#include <CoreFoundation/CoreFoundation.h>
//#import <UIKit/UIKit.h>
#import "common.h"

#define __FILENAME__ (__builtin_strrchr(__FILE__, '/') ? __builtin_strrchr(__FILE__, '/') + 1 : __FILE__)

static char *message = nil;
#define SETMESSAGE(msg) (message = msg)

#define _assert(test, message, fatal) do \
if (!(test)) { \
    int saved_errno = errno; \
    LOG("__assert(%d:%s)@%s:%u[%s]", saved_errno, #test, __FILENAME__, __LINE__, __FUNCTION__); \
if (message != nil) \
    showAlert(fatal ? @"Error (Fatal)" : @"Error (Nonfatal)", [NSString stringWithFormat:@"Errno: %d\nTest: %s\nFilename: %s\nLine: %d\nFunction: %s\nDescription: %@", saved_errno, #test, __FILENAME__, __LINE__, __FUNCTION__, message], true, false); \
else \
    showAlert(fatal ? @"Error (Fatal)" : @"Error (Nonfatal)", [NSString stringWithFormat:@"Errno: %d\nTest: %s\nFilename: %s\nLine: %d\nFunction: %s", saved_errno, #test, __FILENAME__, __LINE__, __FUNCTION__], true, false); \
    if (fatal) { \
        if ([[JailbreakViewController sharedController] canExit]) {\
            exit(EXIT_FAILURE); \
        } else { \
            return; \
        } \
    } \
} \
while (false)

#define NOTICE(msg, wait, destructive) showAlert(@"Notice", msg, wait, destructive)





enum {
    ERR_NOERR = 0,
    ERR_VERSION = -1,
    ERR_EXPLOIT = -2,
    ERR_UNSUPPORTED = -3,
    ERR_TFP0 = -4,
    ERR_ALREADY_JAILBROKEN = -5,
    ERR_AMFID_PATCH = -6,
    ERR_ROOTFS_REMOUNT = -7,
    ERR_SNAPSHOT = -8,
    ERR_JAILBREAK = -9,
    ERR_CONFLICT = -10,
};
extern size_t page_size;
void snapshotWarningRead(void);
int start_Th0r(mach_port_t tipsyPIEfp0, bool enable_tweaks);
int start_jailbreakd(uint64_t kernel_base);
extern int whatsmyuid;

#endif /* electra_h */
